<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>聊天记录API测试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #3498db;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            color: #e74c3c;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>聊天记录API测试工具</h1>
        
        <!-- JWT输入区域 -->
        <div class="section">
            <div class="section-title">认证设置</div>
            <div class="form-group">
                <label for="jwtToken">JWT令牌：</label>
                <input type="text" id="jwtToken" placeholder="输入您的JWT令牌">
            </div>
            <div class="form-group">
                <label for="baseUrl">API基础地址：</label>
                <input type="text" id="baseUrl" value="http://localhost:8080/api">
            </div>
        </div>
        
        <!-- 查询所有聊天记录 -->
        <div class="section">
            <div class="section-title">1. 查询所有聊天记录</div>
            <div class="form-group">
                <label for="userId">用户ID：</label>
                <input type="text" id="userId" placeholder="输入用户ID">
            </div>
            <button onclick="getAllChatHistories()">执行查询</button>
            <div class="response" id="allResponse"></div>
            <div class="error" id="allError"></div>
        </div>
        
        <!-- 查询特定角色聊天记录 -->
        <div class="section">
            <div class="section-title">2. 查询特定角色聊天记录</div>
            <div class="form-group">
                <label for="specificUserId">用户ID：</label>
                <input type="text" id="specificUserId" placeholder="输入用户ID">
            </div>
            <div class="form-group">
                <label for="roleId">角色ID：</label>
                <input type="text" id="roleId" placeholder="输入角色ID">
            </div>
            <button onclick="getChatHistoryByRole()">执行查询</button>
            <div class="response" id="specificResponse"></div>
            <div class="error" id="specificError"></div>
        </div>
    </div>

    <script>
        // 获取所有聊天记录
        function getAllChatHistories() {
            const jwtToken = document.getElementById('jwtToken').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const userId = document.getElementById('userId').value;
            
            // 清除之前的响应和错误
            document.getElementById('allResponse').textContent = '';
            document.getElementById('allError').textContent = '';
            
            if (!jwtToken) {
                document.getElementById('allError').textContent = '错误：请先输入JWT令牌';
                return;
            }
            
            if (!userId) {
                document.getElementById('allError').textContent = '错误：请先输入用户ID';
                return;
            }
            
            const url = `${baseUrl}/history/user/${userId}`;
            
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${jwtToken}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(`HTTP错误! 状态: ${response.status}, 消息: ${err.error || response.statusText}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('allResponse').textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('allError').textContent = `请求失败: ${error.message}`;
            });
        }
        
        // 查询特定角色聊天记录
        function getChatHistoryByRole() {
            const jwtToken = document.getElementById('jwtToken').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const userId = document.getElementById('specificUserId').value;
            const roleId = document.getElementById('roleId').value;
            
            // 清除之前的响应和错误
            document.getElementById('specificResponse').textContent = '';
            document.getElementById('specificError').textContent = '';
            
            if (!jwtToken) {
                document.getElementById('specificError').textContent = '错误：请先输入JWT令牌';
                return;
            }
            
            if (!userId || !roleId) {
                document.getElementById('specificError').textContent = '错误：请先输入用户ID和角色ID';
                return;
            }
            
            const url = `${baseUrl}/history/user/${userId}/role/${roleId}`;
            
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${jwtToken}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(`HTTP错误! 状态: ${response.status}, 消息: ${err.error || response.statusText}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('specificResponse').textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('specificError').textContent = `请求失败: ${error.message}`;
            });
        }
    </script>
</body>
</html>
