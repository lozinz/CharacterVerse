# 交互
![alt text](交互.png)

# 后端需求
1. 用户 登录 && 注册
2. 用户 添加 角色
3. 用户 删除 角色
4. 用户 查询 角色
5. 用户与角色文字聊天
6. 用户与给角色发送语音
7. 用户与角色语音通话聊天

# API 接口
用户注册（user/register）POST
入参：
username 用户名
password 密码
出参：网络码 200

用户登录 （user/login）POST
入参：
username 用户名
password 密码
出参：JWT 


用户添加角色 （user/addRole）POST
入参：
JWT
角色名称
角色描述（存入知识库）

出参：网络码 200 + 角色 ID

# （文字）聊天模块构思
用户 发送消息给 角色
前端 -message（用户id，角色id，消息）> 后端 -> （角色的知识库（角色描述（存在MySQL角色信息里面的 Description 字段）） + message + 角色聊天的历史消息） -> 大模型 （角色的知识库 + message） -> 后端 -> （对应角色的知识库 + message + 大模型生成的回复） -> 前端


# (语音通话)聊天模块构思
用户说话 -> 前端语音转文字（调用语音识别服务）-> 防抖（不说话的时候发送信息）-> 后端（文字聊天模块）-> message + TTS服务 -> 前端 -> 用户


# 文字聊天优化
model 优化
chat_history
user_role_history (存储历史聊天的信息压缩)

message + user_role_history + chat_history(最近的5条信息) -> 大模型 -> 
回复(返回给用户的消息->chat_history -> 用户、存储历史聊天的信息压缩更新-> 存入user_role_history)







# role model 优化
role 表
type Role struct {
	gorm.Model
	Name        string `gorm:"size:100;not null" json:"name"`         // 角色名称
	Description string `gorm:"type:text;not null" json:"description"` // 角色描述
	UserID      uint   `gorm:"not null" json:"user_id"`               // 关联的用户ID
}
需要新增字段：
性别